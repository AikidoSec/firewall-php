# syntax=docker/dockerfile:1.7
FROM ubuntu:24.04

ARG PHP_VERSION=7.2
ENV DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC

# Base OS + tools
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      tzdata ca-certificates curl git gnupg lsb-release software-properties-common \
      python3 python3-pip python3-flask python3-pandas python3-psutil python3-requests \
      nginx apache2 mariadb-server && \
    ln -fs /usr/share/zoneinfo/${TZ} /etc/localtime && \
    dpkg-reconfigure -f noninteractive tzdata


RUN add-apt-repository -y ppa:ondrej/php && \
    apt-get update && \
    apt-get install -y --no-install-recommends \
      php${PHP_VERSION} \
      php${PHP_VERSION}-fpm \
      php${PHP_VERSION}-curl \
      php${PHP_VERSION}-sqlite3 \
      php${PHP_VERSION}-mysqli \
      php${PHP_VERSION}-mysql \
      php${PHP_VERSION}-mbstring \
      php${PHP_VERSION}-xml \
      php${PHP_VERSION}-zip \
      php${PHP_VERSION}-cgi \
      libapache2-mod-php${PHP_VERSION} \
      libapache2-mod-fcgid \
      libfcgi-bin

# Default workdir where your repo will be checked out
WORKDIR /workspace

RUN mkdir -p /var/lib/mysql /run/mysqld
RUN php -m | grep -E 'curl|mysqli|sqlite3' >/dev/null

# No long-running service by default; CI steps will start what they need.
CMD ["bash", "-lc", "php -v && nginx -v && apache2 -v && mysqld --version"]
