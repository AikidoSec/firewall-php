syntax = "proto3";

import "google/protobuf/empty.proto";

package ipc;

option go_package = "ipc/protos;protos";

service Aikido {
  rpc OnDomain (Domain) returns (google.protobuf.Empty);
  rpc OnRequestInit (RequestMetadataInit) returns (RequestStatus);
  rpc OnRequestShutdown (RequestMetadataShutdown) returns (google.protobuf.Empty);
  rpc GetCloudConfig(google.protobuf.Empty) returns (CloudConfig);
}

message Domain {
  string domain = 1;
  int32 port = 2;
}

message RequestMetadataInit {
  string method = 1;
  string route = 2;
}

message RequestMetadataShutdown {
  string method = 1;
  string route = 2;
  int32 statusCode = 3;
}

message RateLimiting {
  bool enabled = 1;
}

message Endpoint {
  string method = 1;
  string route = 2;
  bool forceProtectionOff = 3;
  RateLimiting rateLimiting = 4;
  repeated string allowedIPAddresses = 5;
}

message CloudConfig {
  repeated Endpoint endpoints = 1;
  repeated string blockedUserIds = 2;
  repeated string ipsExcludedFromRateLimiting = 3;
}

message RequestStatus {
  bool forwardToServer = 1;
}